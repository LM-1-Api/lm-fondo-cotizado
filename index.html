<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>LM Fondo Cotizado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- librería de gráficos -->
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body {
      margin: 0;
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: #fff;
    }
    .topbar {
      background: #000;
      border-bottom: 1px solid rgba(198,166,99,.25);
      padding: 14px 14px 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      position: sticky;
      top: 0;
      z-index: 9;
    }
    .topbar-title {
      font-weight: 700;
      font-size: 1.1rem;
    }
    .topbar-row {
      display: flex;
      gap: 14px;
      margin-left: auto;
      font-size: .85rem;
    }
    .topbar-label {
      opacity: .6;
      margin-right: 4px;
    }
    .topbar-value {
      color: #00c853;
      font-weight: 700;
    }

    .panel {
      margin: 12px auto;
      max-width: 980px;
      background: #0f0f10;
      border: 1px solid rgba(198,166,99,.35);
      border-radius: 22px;
      overflow: hidden;
    }
    .panel-header {
      padding: 20px 20px 4px;
    }
    .panel-title {
      font-size: 1.1rem;
      font-weight: 700;
    }
    .panel-sub {
      color: #c6a663;
      font-size: .78rem;
      margin-top: 2px;
    }
    .panel-price {
      font-size: 2.3rem;
      font-weight: 800;
      color: #00c853;
      padding: 6px 20px 12px;
    }
    .tf-row {
      display: flex;
      gap: 10px;
      padding: 0 20px 14px;
    }
    .tf-btn {
      background: #000;
      border: 1px solid transparent;
      border-radius: 11px;
      padding: 7px 15px 8px;
      color: #fff;
      font-size: .8rem;
    }
    .tf-btn.active {
      border-color: #c6a663;
      background: rgba(198,166,99,.04);
    }
    .chart-body {
      height: 280px;
      background: #101010;
    }

    /* logo + leyenda abajo dentro del panel */
    .chart-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px 4px;
      background: #0a0a0a;
      border-top: 1px solid rgba(198,166,99,.12);
    }
    .chart-brand img {
      width: 30px;
      height: 30px;
      object-fit: contain;
      border-radius: 6px;
      background: #000;
      border: 1px solid rgba(198,166,99,.4);
    }
    .chart-brand span {
      font-size: .75rem;
      color: #fff;
      opacity: .8;
    }

    /* barra de fecha y hora en tiempo real */
    .chart-time {
      background: rgba(0,0,0,0.3);
      padding: 5px 16px 8px;
      color: #c6a663;
      font-size: 0.7rem;
      border-bottom-left-radius: 20px;
      border-bottom-right-radius: 20px;
      border-top: 1px solid rgba(198,166,99,0.12);
    }

    @media (max-width: 749px) {
      .panel { border-radius: 0; max-width: 100%; }
      .chart-body { height: 260px; }
      .panel-price { font-size: 2rem; }
      .tf-row { gap: 8px; overflow-x: auto; }
      .topbar-row { display: none; }
    }
  </style>
</head>
<body>

  <!-- TOP -->
  <div class="topbar">
    <div class="topbar-title">LM Fondo Cotizado · USD</div>
    <div class="topbar-row">
      <div><span class="topbar-label">ORO</span> <span id="top-gold" class="topbar-value">--</span></div>
      <div><span class="topbar-label">PLATA</span> <span id="top-silver" class="topbar-value">--</span></div>
    </div>
  </div>

  <!-- PANEL ORO -->
  <div class="panel">
    <div class="panel-header">
      <div class="panel-title">ORO (XAU/USD)</div>
      <div class="panel-sub">Tiempo real · LM Fondo Cotizado</div>
    </div>
    <div id="gold-price" class="panel-price">$--</div>
    <div class="tf-row" data-metal="XAU">
      <button class="tf-btn active" data-tf="1m">1m</button>
      <button class="tf-btn" data-tf="5m">5m</button>
      <button class="tf-btn" data-tf="15m">15m</button>
      <button class="tf-btn" data-tf="1h">1h</button>
      <button class="tf-btn" data-tf="4h">4h</button>
      <button class="tf-btn" data-tf="1d">1d</button>
    </div>
    <div class="chart-body" id="chart-gold"></div>
    <div class="chart-brand">
      <img src="./IMG_2975.PNG" alt="LM">
      <span>LM Fondo Cotizado</span>
    </div>
    <!-- barra de fecha/hora -->
    <div class="chart-time" id="gold-time">Actualizado…</div>
  </div>

  <!-- PANEL PLATA -->
  <div class="panel">
    <div class="panel-header">
      <div class="panel-title">PLATA (XAG/USD)</div>
      <div class="panel-sub">Tiempo real · LM Fondo Cotizado</div>
    </div>
    <div id="silver-price" class="panel-price">$--</div>
    <div class="tf-row" data-metal="XAG">
      <button class="tf-btn active" data-tf="1m">1m</button>
      <button class="tf-btn" data-tf="5m">5m</button>
      <button class="tf-btn" data-tf="15m">15m</button>
      <button class="tf-btn" data-tf="1h">1h</button>
      <button class="tf-btn" data-tf="4h">4h</button>
      <button class="tf-btn" data-tf="1d">1d</button>
    </div>
    <div class="chart-body" id="chart-silver"></div>
    <div class="chart-brand">
      <img src="./IMG_2975.PNG" alt="LM">
      <span>LM Fondo Cotizado</span>
    </div>
    <!-- barra de fecha/hora -->
    <div class="chart-time" id="silver-time">Actualizado…</div>
  </div>

  <script>
    // 1) tu API base (la de Vercel)
    const API_BASE = "https://lm-fondo-cotizado.vercel.app/api"; // si tu endpoint es otro, cámbialo

    // 2) crear gráficos
    const goldChart = LightweightCharts.createChart(document.getElementById('chart-gold'), {
      layout: { background: { color: "#101010" }, textColor: "#ffffff" },
      grid: {
        vertLines: { color: "rgba(198,166,99,0.05)" },
        horzLines: { color: "rgba(198,166,99,0.05)" }
      },
      rightPriceScale: { borderColor: "rgba(198,166,99,0.35)" },
      timeScale: { borderColor: "rgba(198,166,99,0.35)" }
    });
    const goldSeries = goldChart.addCandlestickSeries({
      upColor: "#00c853",
      downColor: "#d32f2f",
      borderUpColor: "#00c853",
      borderDownColor: "#d32f2f",
      wickUpColor: "#00c853",
      wickDownColor: "#d32f2f"
    });

    const silverChart = LightweightCharts.createChart(document.getElementById('chart-silver'), {
      layout: { background: { color: "#101010" }, textColor: "#ffffff" },
      grid: {
        vertLines: { color: "rgba(198,166,99,0.05)" },
        horzLines: { color: "rgba(198,166,99,0.05)" }
      },
      rightPriceScale: { borderColor: "rgba(198,166,99,0.35)" },
      timeScale: { borderColor: "rgba(198,166,99,0.35)" }
    });
    const silverSeries = silverChart.addCandlestickSeries({
      upColor: "#00c853",
      downColor: "#d32f2f",
      borderUpColor: "#00c853",
      borderDownColor: "#d32f2f",
      wickUpColor: "#00c853",
      wickDownColor: "#d32f2f"
    });

    // 3) función para pedir datos (acá usás tu endpoint real)
    async function cargarDatos(metal = "XAU", tf = "1m") {
      try {
        // ejemplo de endpoint: /api?metal=XAU&tf=1m
        const res = await fetch(`${API_BASE}?metal=${metal}&tf=${tf}`);
        const data = await res.json();

        // precio spot arriba
        if (metal === "XAU") {
          document.getElementById("gold-price").textContent = "$" + data.price;
          document.getElementById("top-gold").textContent = "$" + data.price;
          goldSeries.setData(data.candles);
        } else {
          document.getElementById("silver-price").textContent = "$" + data.price;
          document.getElementById("top-silver").textContent = "$" + data.price;
          silverSeries.setData(data.candles);
        }
      } catch (e) {
        console.warn("Error cargando " + metal, e);
      }
    }

    // 4) activar botones de timeframe
    document.querySelectorAll(".tf-row").forEach(row => {
      row.addEventListener("click", (e) => {
        const btn = e.target.closest(".tf-btn");
        if (!btn) return;
        const tf = btn.dataset.tf;
        const metal = row.dataset.metal;
        // activar botón
        row.querySelectorAll(".tf-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        // recargar
        cargarDatos(metal, tf);
      });
    });

    // 5) reloj tiempo real abajo de cada gráfico
    function actualizarRelojLM(idElemento) {
      const el = document.getElementById(idElemento);
      if (!el) return;
      const ahora = new Date();
      const fecha = ahora.toLocaleDateString("es-AR", {
        timeZone: "America/Argentina/Buenos_Aires",
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });
      const hora = ahora.toLocaleTimeString("es-AR", {
        timeZone: "America/Argentina/Buenos_Aires",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
      el.textContent = "Actualizado: " + fecha + " · " + hora + " · LM";
    }
    actualizarRelojLM("gold-time");
    actualizarRelojLM("silver-time");
    setInterval(() => {
      actualizarRelojLM("gold-time");
      actualizarRelojLM("silver-time");
    }, 1000);

    // 6) primera carga
    cargarDatos("XAU", "1m");
    cargarDatos("XAG", "1m");
    // y cada 30s refrescás
    setInterval(() => {
      const goldActive = document.querySelector('.tf-row[data-metal="XAU"] .tf-btn.active').dataset.tf;
      const silverActive = document.querySelector('.tf-row[data-metal="XAG"] .tf-btn.active').dataset.tf;
      cargarDatos("XAU", goldActive);
      cargarDatos("XAG", silverActive);
    }, 30000);
  </script>
</body>
</html>
