<script>
  // üëë TU SERVIDOR QUE S√ç ANDA
  const API_BASE = "https://lm-fondo-cotizado.vercel.app"; // <- este es el bueno

  // 1) crear gr√°ficos
  const goldChart = LightweightCharts.createChart(document.getElementById('chart-gold'), {
    layout: { background: { color: "#101010" }, textColor: "#ffffff" },
    grid: {
      vertLines: { color: "rgba(198,166,99,0.05)" },
      horzLines: { color: "rgba(198,166,99,0.05)" }
    },
    rightPriceScale: { borderColor: "rgba(198,166,99,0.35)" },
    timeScale: { borderColor: "rgba(198,166,99,0.35)" }
  });
  const goldSeries = goldChart.addCandlestickSeries({
    upColor: "#00c853",
    downColor: "#d32f2f",
    borderUpColor: "#00c853",
    borderDownColor: "#d32f2f",
    wickUpColor: "#00c853",
    wickDownColor: "#d32f2f"
  });

  const silverChart = LightweightCharts.createChart(document.getElementById('chart-silver'), {
    layout: { background: { color: "#101010" }, textColor: "#ffffff" },
    grid: {
      vertLines: { color: "rgba(198,166,99,0.05)" },
      horzLines: { color: "rgba(198,166,99,0.05)" }
    },
    rightPriceScale: { borderColor: "rgba(198,166,99,0.35)" },
    timeScale: { borderColor: "rgba(198,166,99,0.35)" }
  });
  const silverSeries = silverChart.addCandlestickSeries({
    upColor: "#00c853",
    downColor: "#d32f2f",
    borderUpColor: "#00c853",
    borderDownColor: "#d32f2f",
    wickUpColor: "#00c853",
    wickDownColor: "#d32f2f"
  });

  // 2) pedir al backend (tus rutas reales)
  async function cargarOro() {
    try {
      const res = await fetch(`${API_BASE}/gold`);
      const data = await res.json();
      // data.price  y data.candles  ‚Üê como lo ten√≠as cuando ‚Äúqued√≥ joya‚Äù
      document.getElementById("gold-price").textContent = "$" + data.price;
      document.getElementById("top-gold").textContent = "$" + data.price;
      if (Array.isArray(data.candles)) {
        goldSeries.setData(data.candles);
      }
    } catch (e) {
      console.warn("No pude cargar ORO", e);
    }
  }

  async function cargarPlata() {
    try {
      const res = await fetch(`${API_BASE}/silver`);
      const data = await res.json();
      document.getElementById("silver-price").textContent = "$" + data.price;
      document.getElementById("top-silver").textContent = "$" + data.price;
      if (Array.isArray(data.candles)) {
        silverSeries.setData(data.candles);
      }
    } catch (e) {
      console.warn("No pude cargar PLATA", e);
    }
  }

  // 3) botones de timeframe (visual, porque tu backend ahora mismo no cambia por tf)
  document.querySelectorAll(".tf-row").forEach(row => {
    row.addEventListener("click", (e) => {
      const btn = e.target.closest(".tf-btn");
      if (!btn) return;
      row.querySelectorAll(".tf-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      // si despu√©s tu backend acepta ?tf=..., ac√° lo activamos de nuevo
    });
  });

  // 4) reloj en tiempo real abajo de cada panel
  function actualizarRelojLM(id) {
    const el = document.getElementById(id);
    if (!el) return;
    const ahora = new Date();
    const fecha = ahora.toLocaleDateString("es-AR", {
      timeZone: "America/Argentina/Buenos_Aires",
      day: "2-digit", month: "2-digit", year: "numeric"
    });
    const hora = ahora.toLocaleTimeString("es-AR", {
      timeZone: "America/Argentina/Buenos_Aires",
      hour: "2-digit", minute: "2-digit", second: "2-digit"
    });
    el.textContent = `Actualizado: ${fecha} ¬∑ ${hora} ¬∑ LM`;
  }
  actualizarRelojLM("gold-time");
  actualizarRelojLM("silver-time");
  setInterval(() => {
    actualizarRelojLM("gold-time");
    actualizarRelojLM("silver-time");
  }, 1000);

  // 5) primera carga
  cargarOro();
  cargarPlata();

  // 6) refresco cada 30s
  setInterval(() => {
    cargarOro();
    cargarPlata();
  }, 30000);
</script>
