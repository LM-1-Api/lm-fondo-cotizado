<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>LM Fondo Cotizado</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- LIBRERA DE GRFICOS -->
    <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
    <style>
      :root {
        --lm-bg: #1a1a1a;
        --lm-card: #101010;
        --lm-gold: #c6a663;
        --lm-line: rgba(198, 166, 99, 0.4);
        --lm-text: #ffffff;
        --lm-green: #00c853;
        --lm-red: #d32f2f;
        --lm-border: #c6a663;
      }
      body {
        margin: 0;
        background: var(--lm-bg);
        color: var(--lm-text);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        background: #000;
        padding: 14px 16px 10px;
        border-bottom: 1px solid rgba(198, 166, 99, 0.25);
        font-size: 14px;
      }
      .topbar-left {
        display: flex;
        gap: 10px;
        align-items: center;
        font-weight: 600;
      }
      .topbar-right {
        display: flex;
        gap: 18px;
        align-items: center;
      }
      .ticker {
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .ticker label {
        color: rgba(255,255,255,0.55);
        font-size: 12px;
      }
      .lm-page {
        padding: 14px 10px 80px;
      }
      .lm-card {
        background: #0c0c0c;
        border: 1px solid rgba(198, 166, 99, 0.6);
        border-radius: 22px;
        margin-bottom: 14px;
        overflow: hidden;
      }
      .lm-card-header {
        padding: 16px 16px 10px;
      }
      .lm-title {
        font-size: 18px;
        font-weight: 700;
        letter-spacing: 0.02em;
      }
      .lm-sub {
        font-size: 13px;
        margin-top: 4px;
        color: rgba(255, 255, 255, 0.55);
      }
      .lm-price-big {
        font-size: 30px;
        font-weight: 800;
        color: var(--lm-green);
        margin-top: 6px;
      }
      .tf-row {
        display: flex;
        gap: 10px;
        padding: 10px 16px 12px;
      }
      .tf-btn {
        background: #000;
        border: none;
        color: #fff;
        padding: 7px 20px 8px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
      }
      .tf-btn.active {
        border: 1px solid var(--lm-gold);
        background: rgba(198, 166, 99, 0.12);
      }
      .chart-wrap {
        position: relative;
        height: 300px;
        margin: 0 6px 0 6px;
      }
      .chart-body {
        width: 100%;
        height: 100%;
      }
      .chart-watermark {
        position: absolute;
        left: 14px;
        bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
        pointer-events: none;
      }
      .chart-watermark img {
        height: 32px;
        width: auto;
        border-radius: 4px;
      }
      .chart-watermark span {
        font-size: 13px;
      }
      .lm-footer {
        padding: 6px 16px 10px;
        border-top: 1px solid rgba(198,166,99,0.12);
        font-size: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }
      .updated {
        color: rgba(255,255,255,0.4);
      }
      @media (min-width: 1024px) {
        .lm-page {
          max-width: 1200px;
          margin: 0 auto;
        }
        .chart-wrap {
          height: 350px;
        }
      }
    </style>
  </head>
  <body>
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="topbar-left">
        <span class="lm-title" style="font-size:14px;">LM Fondo Cotizado 路 USD</span>
      </div>
      <div class="topbar-right">
        <div class="ticker">
          <label>ORO</label>
          <span id="top-gold" style="color:#00c853;">$--</span>
        </div>
        <div class="ticker">
          <label>PLATA</label>
          <span id="top-silver" style="color:#00c853;">$--</span>
        </div>
      </div>
    </div>

    <div class="lm-page">
      <!-- CARD ORO -->
      <div class="lm-card" id="card-gold">
        <div class="lm-card-header">
          <div class="lm-title">ORO (XAU/USD)</div>
          <div class="lm-sub">Tiempo real 路 LM Fondo Cotizado</div>
          <div class="lm-price-big" id="gold-price-big">$--</div>
        </div>
        <div class="tf-row" data-metal="XAU">
          <button class="tf-btn active" data-tf="1m">1m</button>
          <button class="tf-btn" data-tf="5m">5m</button>
          <button class="tf-btn" data-tf="15m">15m</button>
          <button class="tf-btn" data-tf="1h">1h</button>
          <button class="tf-btn" data-tf="4h">4h</button>
          <button class="tf-btn" data-tf="1d">1d</button>
        </div>
        <div class="chart-wrap">
          <div id="chart-gold" class="chart-body"></div>
          <!--  AQU VA TU LOGO DENTRO DEL GRFICO -->
          <div class="chart-watermark">
            <img src="/IMG_2975.PNG" alt="LM" />
            <span>LM Fondo Cotizado</span>
          </div>
        </div>
        <div class="lm-footer">
          <span id="gold-updated" class="updated">Actualizado: --/--/---- --:--:-- 路 LM</span>
          <span style="color:rgba(198,166,99,0.7);font-weight:600;">XAU/USD</span>
        </div>
      </div>

      <!-- CARD PLATA -->
      <div class="lm-card" id="card-silver">
        <div class="lm-card-header">
          <div class="lm-title">PLATA (XAG/USD)</div>
          <div class="lm-sub">Tiempo real 路 LM Fondo Cotizado</div>
          <div class="lm-price-big" id="silver-price-big">$--</div>
        </div>
        <div class="tf-row" data-metal="XAG">
          <button class="tf-btn active" data-tf="1m">1m</button>
          <button class="tf-btn" data-tf="5m">5m</button>
          <button class="tf-btn" data-tf="15m">15m</button>
          <button class="tf-btn" data-tf="1h">1h</button>
          <button class="tf-btn" data-tf="4h">4h</button>
          <button class="tf-btn" data-tf="1d">1d</button>
        </div>
        <div class="chart-wrap">
          <div id="chart-silver" class="chart-body"></div>
          <div class="chart-watermark">
            <img src="/IMG_2975.PNG" alt="LM" />
            <span>LM Fondo Cotizado</span>
          </div>
        </div>
        <div class="lm-footer">
          <span id="silver-updated" class="updated">Actualizado: --/--/---- --:--:-- 路 LM</span>
          <span style="color:rgba(198,166,99,0.7);font-weight:600;">XAG/USD</span>
        </div>
      </div>
    </div>

    <script>
      //  SI VERGEL TE SIRVE CON RELATIVO, DEJALO VACO
      const API_BASE = "";

      // ---------- HELPER FECHA ----------
      function formatDateTime(d) {
        const dd = String(d.getDate()).padStart(2, "0");
        const mm = String(d.getMonth() + 1).padStart(2, "0");
        const yyyy = d.getFullYear();
        const hh = String(d.getHours()).padStart(2, "0");
        const mi = String(d.getMinutes()).padStart(2, "0");
        const ss = String(d.getSeconds()).padStart(2, "0");
        return `${dd}/${mm}/${yyyy} - ${hh}:${mi}:${ss}`;
      }

      // ---------- CHART FACTORY ----------
      function createLmChart(containerId) {
        const chart = LightweightCharts.createChart(document.getElementById(containerId), {
          layout: {
            background: { color: "#0c0c0c" },
            textColor: "#ffffff",
          },
          grid: {
            vertLines: { color: "rgba(198,166,99,0.05)" },
            horzLines: { color: "rgba(198,166,99,0.05)" },
          },
          rightPriceScale: {
            borderColor: "rgba(198,166,99,0.4)",
          },
          timeScale: {
            borderColor: "rgba(198,166,99,0.4)",
          },
          crosshair: {
            mode: LightweightCharts.CrosshairMode.Normal,
          },
        });

        const series = chart.addCandlestickSeries({
          upColor: "#00c853",
          borderUpColor: "#00c853",
          wickUpColor: "#00c853",
          downColor: "#d32f2f",
          borderDownColor: "#d32f2f",
          wickDownColor: "#d32f2f",
        });

        return { chart, series };
      }

      const goldChart = createLmChart("chart-gold");
      const silverChart = createLmChart("chart-silver");

      // ---------- GENERADOR DE VELAS FAKE (pero cambian seg煤n timeframe) ----------
      function generateCandles(lastPrice, tf) {
        // m谩s velas para timeframes grandes
        let points = 40;
        if (tf === "1m") points = 40;
        if (tf === "5m") points = 60;
        if (tf === "15m") points = 80;
        if (tf === "1h") points = 100;
        if (tf === "4h") points = 120;
        if (tf === "1d") points = 140;

        const now = Math.floor(Date.now() / 1000);
        const candles = [];
        let price = lastPrice || 2000;

        for (let i = points; i > 0; i--) {
          const t = now - i * 60;
          const volatility = lastPrice ? lastPrice * 0.0007 : 1.5;
          const open = price;
          const close = open + (Math.random() - 0.5) * volatility;
          const high = Math.max(open, close) + Math.random() * volatility * 0.4;
          const low = Math.min(open, close) - Math.random() * volatility * 0.4;
          candles.push({
            time: t,
            open: Number(open.toFixed(2)),
            high: Number(high.toFixed(2)),
            low: Number(low.toFixed(2)),
            close: Number(close.toFixed(2)),
          });
          price = close;
        }
        return candles;
      }

      // ---------- CARGA PRECIOS ----------
      async function loadGold(tf = "1m") {
        try {
          const res = await fetch(`${API_BASE}/gold`);
          const data = await res.json();
          const price = data.price ? Number(data.price) : null;

          // pinta precios
          if (price) {
            document.getElementById("gold-price-big").textContent = `$${price.toFixed(2)}`;
            document.getElementById("top-gold").textContent = `$${price.toFixed(2)}`;
          } else {
            document.getElementById("gold-price-big").textContent = "$--";
          }

          // fecha
          document.getElementById("gold-updated").textContent =
            "Actualizado: " + formatDateTime(new Date()) + " 路 LM";

          // velas
          const candles = generateCandles(price || 2000, tf);
          goldChart.series.setData(candles);
        } catch (err) {
          console.log("error oro", err);
          document.getElementById("gold-price-big").textContent = "$--";
        }
      }

      async function loadSilver(tf = "1m") {
        try {
          const res = await fetch(`${API_BASE}/silver`);
          const data = await res.json();
          const price = data.price ? Number(data.price) : null;

          if (price) {
            document.getElementById("silver-price-big").textContent = `$${price.toFixed(2)}`;
            document.getElementById("top-silver").textContent = `$${price.toFixed(2)}`;
          } else {
            document.getElementById("silver-price-big").textContent = "$--";
          }

          document.getElementById("silver-updated").textContent =
            "Actualizado: " + formatDateTime(new Date()) + " 路 LM";

          const candles = generateCandles(price || 25, tf);
          silverChart.series.setData(candles);
        } catch (err) {
          console.log("error plata", err);
          document.getElementById("silver-price-big").textContent = "$--";
        }
      }

      // ---------- BOTONES DE TIMEFRAME ----------
      document.querySelectorAll(".tf-row").forEach((row) => {
        row.addEventListener("click", (e) => {
          if (!e.target.matches(".tf-btn")) return;
          const metal = row.dataset.metal; // XAU o XAG
          const tf = e.target.dataset.tf;
          // activo
          row.querySelectorAll(".tf-btn").forEach((b) => b.classList.remove("active"));
          e.target.classList.add("active");
          // recarga
          if (metal === "XAU") loadGold(tf);
          if (metal === "XAG") loadSilver(tf);
        });
      });

      // primer load
      loadGold("1m");
      loadSilver("1m");
      // refresco cada 60s
      setInterval(() => {
        const goldActive = document.querySelector('.tf-row[data-metal="XAU"] .tf-btn.active').dataset.tf;
        const silverActive = document.querySelector('.tf-row[data-metal="XAG"] .tf-btn.active').dataset.tf;
        loadGold(goldActive);
        loadSilver(silverActive);
      }, 60000);
    </script>
  </body>
</html>
